# 011: Cognitive Mapï¼ˆç°¡æ˜“ç‰ˆï¼šãƒªã‚¹ãƒˆå½¢å¼ï¼‰

## æ¦‚è¦

ä¾¡å€¤è¦³ãƒ»å¼·ã¿ãƒ»é€ƒã’ç™–ãƒ»æˆæœç‰©ã‚’ãƒªã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤ºã™ã‚‹ç°¡æ˜“ç‰ˆCognitive Mapã‚’å®Ÿè£…ã™ã‚‹ã€‚ã‚°ãƒ©ãƒ•æç”»ã¯Phase Bã§å¯¾å¿œã€‚

## Phase

**Phase A: MVP**

## å„ªå…ˆåº¦

ä¸­

## ä¾å­˜é–¢ä¿‚

- å‰æ: 006 è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ 
- å¾Œç¶š: 014 Cognitive Mapï¼ˆã‚°ãƒ©ãƒ•æç”»ç‰ˆï¼‰

---

## æ©Ÿèƒ½è¦ä»¶ï¼ˆMVPç‰ˆï¼‰

### 1. è¡¨ç¤ºé …ç›®ï¼ˆãƒªã‚¹ãƒˆå½¢å¼ï¼‰

| ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | ã‚½ãƒ¼ã‚¹ |
|---------|------|--------|
| èª“ã„ï¼ˆVowï¼‰ | ä¸­å¿ƒã®èª“ã„ | Day0ã§ç”Ÿæˆ |
| æ„å‘³ï¼ˆMeaningï¼‰ | åŒ—æ¥µæ˜Ÿ | Day0ã§ç”Ÿæˆ |
| ä¾¡å€¤è¦³ï¼ˆValuesï¼‰ | è­²ã‚Œãªã„ã‚‚ã® | Meaning Forge / æ‰‹å‹• |
| å¼·ã¿ï¼ˆStrengthsï¼‰ | ã§ãã‚‹ã“ã¨ | Meaning Forge / æ‰‹å‹• |
| é€ƒã’ç™–ï¼ˆAnti-Patternï¼‰ | æ•µã®ãƒ‘ã‚¿ãƒ¼ãƒ³ | Day0ã§æŠ½å‡º |
| æˆæœç‰©ï¼ˆAchievementï¼‰ | é”æˆã—ãŸã“ã¨ | Evidenceé€£æº |

### 2. åŸºæœ¬æ“ä½œ

- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
- é …ç›®ã®è¿½åŠ ï¼ˆæ‰‹å‹•ï¼‰
- é …ç›®ã®ç·¨é›†
- é …ç›®ã®å‰Šé™¤

### 3. è‡ªå‹•è¿½åŠ 

- Day0ã§ç”Ÿæˆã•ã‚ŒãŸVow, Meaning, Anti-Patternã‚’è‡ªå‹•ç™»éŒ²
- Evidenceè¿½åŠ æ™‚ã«æˆæœç‰©ã¨ã—ã¦è‡ªå‹•ç™»éŒ²ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## UIè¨­è¨ˆï¼ˆMVPç‰ˆï¼‰

### ãƒãƒƒãƒ—ç”»é¢ï¼ˆãƒªã‚¹ãƒˆå½¢å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cognitive Map      [+è¿½åŠ ]  â”‚
â”‚  [èª“ã„] [æ„å‘³] [é€ƒã’ç™–]      â”‚ â† ã‚¿ãƒ–
â”‚  [ä¾¡å€¤è¦³] [å¼·ã¿] [æˆæœç‰©]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚
â”‚  â­ èª“ã„ï¼ˆVowï¼‰              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ "ç§ã¯ã“ã®3ãƒ¶æœˆã§ã€     â”‚  â”‚
â”‚  â”‚  ã€‡ã€‡ã‚’å’æ¥­ã—ã€        â”‚  â”‚
â”‚  â”‚  â–³â–³ã«ãªã‚‹"            â”‚  â”‚
â”‚  â”‚  v2 - 2024/01/15æ›´æ–°   â”‚  â”‚
â”‚  â”‚  [ç·¨é›†] [å±¥æ­´]          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  ğŸ“ æ„å‘³ï¼ˆMeaning Statementï¼‰â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ "ã€‡ã€‡ã¨ã„ã†ç—›ã¿ã‚’ä¹—ã‚Šè¶Šãˆã€â”‚
â”‚  â”‚  â–³â–³ãªè‡ªåˆ†ã«ãªã‚‹"       â”‚  â”‚
â”‚  â”‚  [ç·¨é›†]                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€ƒã’ç™–ã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš”ï¸ é€ƒã’ç™–ï¼ˆAnti-Patternï¼‰   â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. ç· ã‚åˆ‡ã‚ŠãŒè¿‘ã¥ãã¨    â”‚  â”‚
â”‚  â”‚    é€ƒã’ã¦ã—ã¾ã†          â”‚  â”‚
â”‚  â”‚    [ç·¨é›†] [å‰Šé™¤]         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. é›£ã—ã„ã¨æ„Ÿã˜ã‚‹ã¨      â”‚  â”‚
â”‚  â”‚    å…ˆå»¶ã°ã—ã«ã—ã¦ã—ã¾ã†  â”‚  â”‚
â”‚  â”‚    [ç·¨é›†] [å‰Šé™¤]         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  [+ é€ƒã’ç™–ã‚’è¿½åŠ ]            â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æˆæœç‰©ã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† æˆæœç‰©ï¼ˆAchievementï¼‰    â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“¸ æœ5æ™‚èµ·åºŠé”æˆ        â”‚  â”‚
â”‚  â”‚    2024/01/10           â”‚  â”‚
â”‚  â”‚    Evidenceé€£æº          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ”— ãƒ–ãƒ­ã‚°è¨˜äº‹å…¬é–‹        â”‚  â”‚
â”‚  â”‚    2024/01/08           â”‚  â”‚
â”‚  â”‚    Evidenceé€£æº          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚
â”‚  [+ æˆæœç‰©ã‚’è¿½åŠ ]            â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### map_nodes ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE map_nodes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) NOT NULL,
  type VARCHAR(50) NOT NULL, -- 'vow' | 'meaning' | 'value' | 'strength' | 'anti_pattern' | 'achievement'
  content TEXT NOT NULL,
  source_type VARCHAR(50), -- 'day0' | 'meaning_forge' | 'evidence' | 'manual'
  source_id UUID, -- å…ƒã®evidenceãªã©ã®ID
  version INTEGER DEFAULT 1,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### map_node_versions ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆç·¨é›†å±¥æ­´ï¼‰

```sql
CREATE TABLE map_node_versions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  node_id UUID REFERENCES map_nodes(id) NOT NULL,
  version INTEGER NOT NULL,
  content TEXT NOT NULL,
  edited_at TIMESTAMP DEFAULT NOW()
);
```

---

## APIè¨­è¨ˆ

### GET /api/map/nodes

ãƒãƒ¼ãƒ‰ä¸€è¦§ã‚’å–å¾—

**Query Parameters:**
- `type`: 'vow' | 'meaning' | 'value' | 'strength' | 'anti_pattern' | 'achievement'

**Response:**
```json
{
  "nodes": [
    {
      "id": "uuid",
      "type": "vow",
      "content": "ç§ã¯ã“ã®3ãƒ¶æœˆã§...",
      "version": 2,
      "source_type": "day0",
      "updated_at": "2024-01-15T10:00:00Z"
    }
  ]
}
```

### POST /api/map/nodes

ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ 

**Request:**
```json
{
  "type": "value",
  "content": "èª å®Ÿã•ã‚’å¤§åˆ‡ã«ã™ã‚‹"
}
```

### PUT /api/map/nodes/:id

ãƒãƒ¼ãƒ‰ã‚’æ›´æ–°ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ã‚’ç”Ÿæˆï¼‰

**Request:**
```json
{
  "content": "æ›´æ–°ã•ã‚ŒãŸå†…å®¹"
}
```

### DELETE /api/map/nodes/:id

ãƒãƒ¼ãƒ‰ã‚’å‰Šé™¤ï¼ˆis_active = falseï¼‰

### GET /api/map/nodes/:id/versions

ç·¨é›†å±¥æ­´ã‚’å–å¾—

---

## è‡ªå‹•ãƒãƒ¼ãƒ‰ç”Ÿæˆ

### Day0å®Œäº†æ™‚

```typescript
async function createInitialMapNodes(
  userId: string,
  vow: string,
  meaningStatement: string,
  antiPatterns: string[]
) {
  // Vowãƒãƒ¼ãƒ‰
  await createNode(userId, 'vow', vow, 'day0');

  // Meaning Statementãƒãƒ¼ãƒ‰
  await createNode(userId, 'meaning', meaningStatement, 'day0');

  // Anti-Patternãƒãƒ¼ãƒ‰
  for (const pattern of antiPatterns) {
    await createNode(userId, 'anti_pattern', pattern, 'day0');
  }
}
```

### Evidenceè¿½åŠ æ™‚ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```typescript
async function createAchievementFromEvidence(
  userId: string,
  evidence: Evidence
) {
  await createNode(
    userId,
    'achievement',
    evidence.title,
    'evidence',
    evidence.id
  );
}
```

---

## Todo

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- [ ] map_nodes ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] map_node_versions ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] RLSè¨­å®š

### UIå®Ÿè£…
- [ ] ãƒãƒƒãƒ—ç”»é¢ï¼ˆã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼‰
- [ ] ãƒãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- [ ] ãƒãƒ¼ãƒ‰è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«
- [ ] ãƒãƒ¼ãƒ‰ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«
- [ ] ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´è¡¨ç¤º

### APIå®Ÿè£…
- [ ] GET /api/map/nodes
- [ ] POST /api/map/nodes
- [ ] PUT /api/map/nodes/:id
- [ ] DELETE /api/map/nodes/:id
- [ ] GET /api/map/nodes/:id/versions

### è‡ªå‹•ç”Ÿæˆ
- [ ] Day0å®Œäº†æ™‚ã®ãƒãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆ
- [ ] Evidenceè¿½åŠ æ™‚ã®æˆæœç‰©ãƒãƒ¼ãƒ‰ç”Ÿæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## å®Œäº†æ¡ä»¶

1. ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ãƒãƒ¼ãƒ‰ãŒãƒªã‚¹ãƒˆè¡¨ç¤ºã•ã‚Œã‚‹
2. ãƒãƒ¼ãƒ‰ã‚’æ‰‹å‹•ã§è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã§ãã‚‹
3. Day0ã§ç”Ÿæˆã•ã‚ŒãŸVow/Meaning/Anti-PatternãŒè‡ªå‹•ç™»éŒ²ã•ã‚Œã‚‹
4. ç·¨é›†å±¥æ­´ãŒä¿å­˜ãƒ»è¡¨ç¤ºã•ã‚Œã‚‹
5. Evidenceè¿½åŠ æ™‚ã«æˆæœç‰©ã¨ã—ã¦ç™»éŒ²ã§ãã‚‹
